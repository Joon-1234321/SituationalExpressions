<!DOCTYPE html>
<html lang="ko" data-theme="sky">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‹¨ì–´ ëœ» ë§¤ì¹­ ê²Œì„</title>
  <style>
    :root{
      /* Sky(ì§„í•œ) í†¤ */
      --bg1:#e2e8ff; --bg2:#dbeafe;
      --accent:#1d4ed8; --ink:#1f2937; --sub:#6b7280;
      --card:#ffffff; --border:#e5e7eb; --good:#059669; --bad:#dc2626;
      --shadow:0 10px 25px rgba(0,0,0,.08);
    }
    html,body{margin:0;padding:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,sans-serif;color:var(--ink)}
    .wrap{max-width:1100px;margin:22px auto;padding:14px}
    h1{margin:0 0 4px;font-size:22px}
    .sub{color:var(--sub);font-size:14px;margin-bottom:12px}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0 16px}
    .btn{border:1px solid var(--border);background:#fff;color:#111;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
    .btn.warn{background:#fff; color:var(--bad)}
    .stat{margin-left:auto;display:flex;gap:12px;flex-wrap:wrap;align-items:center;color:#111;font-weight:700}
    .chip{padding:6px 10px;border-radius:999px;background:#fff;border:1px solid var(--border);font-size:13px}
    .timer{font-variant-numeric:tabular-nums}

    .board{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:860px){ .board{grid-template-columns:1fr 1fr} }

    .col{background:#ffffffa8; backdrop-filter: blur(4px);
      border:1px solid var(--border); border-radius:16px; padding:12px; box-shadow:var(--shadow)}
    .col h2{margin:2px 4px 10px;font-size:16px;color:#374151}

    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px}
    @media (min-width:540px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr))} }
    @media (min-width:980px){ .grid{grid-template-columns:repeat(4,minmax(0,1fr))} }

    .card{
      background:#fff;border:1px solid var(--border);border-radius:14px;padding:10px 12px;
      box-shadow:var(--shadow);cursor:pointer;min-height:54px;display:flex;align-items:center;justify-content:center;
      text-align:center;line-height:1.35;font-weight:700;user-select:none;transition:transform .05s ease, box-shadow .2s ease, opacity .2s ease
    }
    .card:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(0,0,0,.10)}
    .card.selected{outline:3px solid color-mix(in srgb, var(--accent) 35%, transparent)}
    .card.good{outline:3px solid color-mix(in srgb, var(--good) 45%, transparent)}
    .card.bad{animation:shake .18s 2}
    .card.gone{opacity:0; transform:scale(.92); pointer-events:none}
    @keyframes shake{10%{transform:translateX(-2px)} 30%{transform:translateX(3px)} 50%{transform:translateX(-2px)} 70%{transform:translateX(2px)} 90%{transform:translateX(-1px)}}

    .center{display:flex;justify-content:center;align-items:center;gap:10px}
    .muted{color:#64748b;font-size:13px}

    /* Result modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.18)}
    .modal.on{display:flex}
    .sheet{background:#fff;border:1px solid var(--border);border-radius:18px;padding:16px 18px;box-shadow:var(--shadow);max-width:360px;width:92%}
    .sheet h3{margin:4px 0 12px}
    .sheet .row{display:flex;justify-content:space-between;margin:6px 0;font-weight:700}
    .sheet .ok{margin-top:12px}
    .ok .btn{width:100%}

    /* Print */
    @media print{
      .toolbar,.modal{display:none !important}
      body{background:#fff}
      .wrap{margin:0;max-width:100%;padding:0}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ë‹¨ì–´ ëœ» ë§¤ì¹­ ê²Œì„</h1>
    <div class="sub">ë‹¨ì–´ ì¹´ë“œ í•˜ë‚˜, ëœ» ì¹´ë“œ í•˜ë‚˜ë¥¼ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì„¸ìš”. ë§ìœ¼ë©´ ë‘ ì¹´ë“œê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ëª¨ë‘ ì‚¬ë¼ì§ˆ ë•Œê¹Œì§€ ì‹œê°„ì„ ê¸°ë¡í•©ë‹ˆë‹¤.</div>

    <div class="toolbar">
      <button class="btn primary" id="startBtn">ì‹œì‘</button>
      <button class="btn warn" id="resetBtn" title="ìƒˆë¡œ ì„ê³  ì²˜ìŒë¶€í„°">ë‹¤ì‹œí•˜ê¸°</button>
      <div class="stat">
        <span class="chip">ì§„í–‰: <span id="progress">0</span>/<span id="total">0</span></span>
        <span class="chip timer">ì‹œê°„: <span id="time">00:00.00</span></span>
        <span class="chip">ìµœê³ ê¸°ë¡: <span id="best">â€”</span></span>
      </div>
    </div>

    <section class="board" aria-label="ë§¤ì¹­ ë³´ë“œ">
      <div class="col">
        <h2>ë‹¨ì–´</h2>
        <div id="words" class="grid"></div>
      </div>
      <div class="col">
        <h2>ëœ»</h2>
        <div id="defs" class="grid"></div>
      </div>
    </section>

    <!-- ì™„ë£Œ ëª¨ë‹¬ -->
    <div id="modal" class="modal" aria-hidden="true">
      <div class="sheet" role="dialog" aria-modal="true">
        <h3>ğŸ‰ ì™„ë£Œ!</h3>
        <div class="row"><span>ê¸°ë¡</span><span id="finalTime">00:00.00</span></div>
        <div class="row"><span>ìµœê³ ê¸°ë¡</span><span id="finalBest">â€”</span></div>
        <div class="ok center"><button class="btn primary" id="againBtn">ë‹¤ì‹œí•˜ê¸°</button></div>
      </div>
    </div>
  </div>

  <script>
    /* ========= ë°ì´í„° (ì—¬ê¸°ë§Œ êµì²´í•˜ë©´ ë‹¨ì–´ì…‹ ë³€ê²½) ========= */
    const DATA = [
      ["misunderstanding","ì˜¤í•´"],
      ["apologize","ì‚¬ê³¼í•˜ë‹¤"],
      ["scary","ë¬´ì„œìš´"],
      ["note","ìª½ì§€, ë©”ëª¨"],
      ["surprised","ë†€ë€"],
      ["wish","ì†Œì›"],
      ["rebuild","ë‹¤ì‹œ ë§Œë“¤ë‹¤, ì¬ê±´í•˜ë‹¤"],
      ["friendship","ìš°ì •"],
      ["upset","ì†ìƒí•œ"],
      ["need","í•„ìš”ë¡œ í•˜ë‹¤"],
      ["trust","ë¯¿ë‹¤, ì‹ ë¢°í•˜ë‹¤"],
      ["clear","ë¶„ëª…í•œ; ì¹˜ìš°ë‹¤"],
      ["clear the air","ì˜¤í•´(ê¸´ì¥)ì„ í’€ë‹¤"],
      ["explain","ì„¤ëª…í•˜ë‹¤"],
      ["mistake","ì‹¤ìˆ˜"],
      ["listen","ë“£ë‹¤"],
      ["avoid","í”¼í•˜ë‹¤"],
      ["confusion","í˜¼ë€"],
      ["take turns","ë²ˆê°ˆì•„ í•˜ë‹¤"],
      ["perfect","ì™„ë²½í•œ"],
      ["sincere","ì§„ì‹¬ ì–´ë¦°"],
      ["choice","ì„ íƒ"],
      ["choose","ì„ íƒí•˜ë‹¤"],
      ["kindness","ì¹œì ˆ"]
    ];
    /* ========================================================= */

    // ìš”ì†Œ
    const wordsEl = document.getElementById('words');
    const defsEl  = document.getElementById('defs');
    const progressEl = document.getElementById('progress');
    const totalEl    = document.getElementById('total');
    const timeEl     = document.getElementById('time');
    const bestEl     = document.getElementById('best');
    const startBtn   = document.getElementById('startBtn');
    const resetBtn   = document.getElementById('resetBtn');
    const modal      = document.getElementById('modal');
    const finalTime  = document.getElementById('finalTime');
    const finalBest  = document.getElementById('finalBest');
    const againBtn   = document.getElementById('againBtn');

    // ìƒíƒœ
    let pairs = [];       // [{id,word,def}]
    let shuffledWords = [];
    let shuffledDefs  = [];
    let selected = null;  // {side:'word'|'def', id, el}
    let matchedCount = 0;

    // íƒ€ì´ë¨¸
    let timer = {running:false, start:0, raf:0, elapsed:0};
    const keyForBest = "match_best_" + hash(JSON.stringify(DATA));

    function formatTime(ms){
      const t = Math.max(0, ms|0);
      const m = Math.floor(t/60000);
      const s = Math.floor((t%60000)/1000);
      const c = Math.floor((t%1000)/10);
      return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${String(c).padStart(2,'0')}`;
    }
    function loop(){
      if (!timer.running) return;
      timer.elapsed = performance.now() - timer.start;
      timeEl.textContent = formatTime(timer.elapsed);
      timer.raf = requestAnimationFrame(loop);
    }
    function startTimer(){
      timer.running = true;
      timer.start = performance.now();
      timer.elapsed = 0;
      timeEl.textContent = "00:00.00";
      cancelAnimationFrame(timer.raf);
      loop();
    }
    function stopTimer(){
      if (!timer.running) return;
      timer.running = false;
      cancelAnimationFrame(timer.raf);
    }

    // ì…‹ì—…
    function initRound(){
      matchedCount = 0;
      progressEl.textContent = matchedCount;
      totalEl.textContent = DATA.length;
      selected = null;
      stopTimer();
      timeEl.textContent = "00:00.00";

      pairs = DATA.map((d,i)=>({id:i+1, word:d[0], def:d[1]}));
      shuffledWords = shuffle([...pairs]);
      shuffledDefs  = shuffle([...pairs]);

      wordsEl.innerHTML = "";
      defsEl.innerHTML  = "";
      for (const p of shuffledWords){
        const el = makeCard(p.word, p.id, 'word');
        wordsEl.appendChild(el);
      }
      for (const p of shuffledDefs){
        const el = makeCard(p.def, p.id, 'def');
        defsEl.appendChild(el);
      }

      startBtn.disabled = false;
    }

    function makeCard(text, id, side){
      const el = document.createElement('button');
      el.className = 'card';
      el.textContent = text;
      el.dataset.id = id;
      el.dataset.side = side;
      el.addEventListener('click', ()=>onCardClick(el));
      return el;
    }

    function onCardClick(el){
      if (!timer.running && matchedCount===0){
        startBtn.click(); // ì²« í´ë¦­ìœ¼ë¡œ ìë™ ì‹œì‘
      }
      if (!timer.running) return;

      const id = Number(el.dataset.id);
      const side = el.dataset.side;

      if (el.classList.contains('gone')) return;

      if (selected && selected.side === side){
        selected.el.classList.remove('selected');
        selected = {side,id,el};
        el.classList.add('selected');
        return;
      }

      if (!selected){
        selected = {side,id,el};
        el.classList.add('selected');
        return;
      }

      if (selected.side !== side){
        if (selected.id === id){
          feedbackGood(selected.el, el);
          setTimeout(()=>{
            selected.el.classList.add('gone');
            el.classList.add('gone');
            selected = null;
            matchedCount++;
            progressEl.textContent = matchedCount;

            if (matchedCount === pairs.length){
              stopTimer();
              const rec = timer.elapsed|0;
              const best = updateBest(rec);
              showResult(rec, best);
            }
          }, 140);
        }else{
          feedbackBad(selected.el, el);
          selected.el.classList.remove('selected');
          selected = null;
        }
      }
    }

    function feedbackGood(a,b){
      [a,b].forEach(el=>{
        el.classList.remove('bad'); el.classList.add('good');
        setTimeout(()=>el.classList.remove('good'), 240);
      });
      if (navigator.vibrate) navigator.vibrate(20);
    }
    function feedbackBad(a,b){
      [a,b].forEach(el=>{
        el.classList.add('bad');
        setTimeout(()=>el.classList.remove('bad'), 280);
      });
      if (navigator.vibrate) navigator.vibrate([15,40,15]);
    }

    // ë²„íŠ¼
    startBtn.addEventListener('click', ()=>{
      startBtn.disabled = true;
      startTimer();
    });
    resetBtn.addEventListener('click', ()=>{
      initRound();
    });
    againBtn.addEventListener('click', ()=>{
      closeResult();
      initRound();
      startBtn.click();
    });

    // ì™„ë£Œ ëª¨ë‹¬
    function showResult(recMs, bestMs){
      finalTime.textContent = formatTime(recMs);
      finalBest.textContent = Number.isFinite(bestMs) ? formatTime(bestMs) : "â€”";
      modal.classList.add('on');
      modal.setAttribute('aria-hidden','false');
      confetti(400);
    }
    function closeResult(){
      modal.classList.remove('on');
      modal.setAttribute('aria-hidden','true');
    }
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeResult(); });

    // ë² ìŠ¤íŠ¸ ê¸°ë¡
    function updateBest(recMs){
      const prev = Number(localStorage.getItem(keyForBest));
      let best = prev;
      if (!Number.isFinite(prev) || recMs < prev){
        best = recMs;
        localStorage.setItem(keyForBest, String(best));
      }
      bestEl.textContent = Number.isFinite(best) ? formatTime(best) : "â€”";
      return best;
    }
    function loadBest(){
      const prev = Number(localStorage.getItem(keyForBest));
      bestEl.textContent = Number.isFinite(prev) ? formatTime(prev) : "â€”";
    }

    // ìœ í‹¸
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }
    function hash(s){
      let h=0, i=0, l=s.length;
      while(i<l){ h=(h<<5)-h + s.charCodeAt(i++)|0; }
      return (h>>>0).toString(36);
    }
    function confetti(n=200){
      const c = document.createElement('canvas');
      Object.assign(c.style,{position:'fixed',inset:'0',pointerEvents:'none'});
      document.body.appendChild(c);
      const ctx = c.getContext('2d');
      const dpr = window.devicePixelRatio||1;
      function resize(){ c.width = innerWidth*dpr; c.height = innerHeight*dpr; }
      resize(); window.addEventListener('resize',resize,{once:true});
      const pieces = Array.from({length:n},()=>({
        x: Math.random()*c.width, y: -Math.random()*c.height*0.3,
        r: 3 + Math.random()*5, vy: 1 + Math.random()*3, vx: -1+Math.random()*2,
        a: Math.random()*Math.PI*2, va: -0.1+Math.random()*0.2,
        color: Math.random()<.5 ? '#1d4ed8' : (Math.random()<.5?'#059669':'#e11d48')
      }));
      let t=0;
      (function frame(){
        t++; ctx.clearRect(0,0,c.width,c.height);
        pieces.forEach(p=>{
          p.x+=p.vx; p.y+=p.vy; p.a+=p.va;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
          ctx.fillStyle=p.color; ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
          ctx.restore();
        });
        if (t<180) requestAnimationFrame(frame); else c.remove();
      })();
    }

    // ì‹œì‘
    initRound();
    loadBest();
  </script>
</body>
</html>
