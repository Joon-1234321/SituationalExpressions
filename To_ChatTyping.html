<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>영작 타이핑 - 한 문제씩 진행</title>
<style>
  :root{
    --primary:#1976d2; --ok:#2e7d32; --bad:#c62828; --card:#ffffff; --bg:#f0f4f8;
  }
  body{margin:0;background:var(--bg);font-family:system-ui, Arial, sans-serif;line-height:1.6;padding:20px}
  .app{max-width:900px;margin:auto;background:var(--card);border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.08);padding:24px}
  h1{margin:0 0 12px;font-size:1.35rem}
  .progress{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .bar{height:10px;background:#e0e7ef;border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;background:var(--primary);width:0%}
  .dialogueBox{background:linear-gradient(135deg,#eef5ff,#f7ffef);border:1px solid #dde7f5;padding:18px;border-radius:12px;margin:14px 0;font-size:1.1rem}
  input[type="text"]{
    width:100%;padding:14px 12px;font-size:1.05rem;border:1px solid #cfd8e3;border-radius:10px;outline:none;
  }
  input[type="text"]:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(25,118,210,.12)}
  .btns{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
  button{padding:10px 16px;border:none;border-radius:10px;cursor:pointer;font-weight:600}
  .primary{background:var(--primary);color:#fff}
  .ghost{background:#eef3f9;color:#1b3552}
  .danger{background:#fee8e7;color:#8e1a12}
  .ok{background:#e8f5e9;color:#1b5e20}
  .disabled{opacity:.55;cursor:not-allowed}
  .msg{margin-top:10px;font-weight:700}
  .msg.ok{color:var(--ok)}
  .msg.bad{color:var(--bad)}
  .answerReveal{margin-top:10px;padding:10px;border-left:4px solid var(--primary);background:#f3f8ff;border-radius:6px}
  .footer{margin-top:14px;color:#666;font-size:.95rem}
</style>
</head>
<body>
<div class="app">
  <h1>영작 타이핑 — ( ) 안의 한글을 영어로 쓰기</h1>
  <div class="progress">
    <div>문항 <span id="num">1</span> / <span id="tot">9</span></div>
    <div class="bar" style="width:55%"><span id="bar"></span></div>
  </div>

  <!-- 현재 문항만 표시됩니다 -->
  <div class="dialogueBox" id="dialogue"></div>

  <input id="ans" type="text"
         placeholder="여기에 영어로 입력하세요 (구두점은 생략 가능)"
         autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false" inputmode="latin" />

  <div class="btns">
    <button id="checkBtn" class="primary">정답 확인 (Enter)</button>
    <button id="showBtn" class="ghost disabled" disabled>정답 보기</button>
    <button id="nextBtn" class="ok disabled" disabled>다음 ▶</button>
    <button id="resetBtn" class="danger">다시 풀기</button>
  </div>

  <div id="msg" class="msg"></div>
  <div id="reveal" class="answerReveal" style="display:none"></div>

  <div class="footer">※ 구두점(<code>.,?!</code>)은 생략해도 정답 처리됩니다. 정답을 정확히 입력해야 다음 문제로 넘어갑니다.</div>
</div>

<script>
/* ===== 문항: 화면에는 항상 현재 문항만 보입니다 ===== */
const items = [
  // 1
  { context:'Jina: Minho, (너의 꿈이 무엇이야?)', ans:'what is your dream' },
  // 2
  { context:'Minho: My dream is (진정한 친구를 가지는 것).', ans:'to have a true friend' },
  // 3
  { context:'Jina: I want a friend (함께 놀) after school.', ans:'to play with' },
  // 4
  { context:'Minho: Everyone needs someone (신뢰할).', ans:'to trust' },
  // 5
  { context:'Jina: Yesterday, I visited Jiho (그를 돕기위해) with homework.', ans:'to help him' },
  // 6
  { context:'Minho: You are a good friend (남들을 도와주는).', ans:'to help others' },
  // 7
  { context:'Jina: The best way (친구관계를 유지하는) is to be kind.', ans:'to keep a friend' },
  // 8
  { context:'Jina: The best way to keep a friend is (친절히 대하는 것).', ans:'to be kind' },
  // 9
  { context:'Minho: I want (좋은 친구가 되기를) too.', ans:'to be a good friend' }
];

/* ===== 설정: 오답 허용 횟수 (넘기면 "정답 보기" 활성화) ===== */
const MAX_TRIES = 3;

const total = items.length;
const $num = document.getElementById('num');
const $tot = document.getElementById('tot');
const $bar = document.getElementById('bar');
const $dialogue = document.getElementById('dialogue');
const $ans = document.getElementById('ans');
const $check = document.getElementById('checkBtn');
const $show = document.getElementById('showBtn');
const $next = document.getElementById('nextBtn');
const $reset = document.getElementById('resetBtn');
const $msg = document.getElementById('msg');
const $reveal = document.getElementById('reveal');

$tot.textContent = total;

let idx = 0;
let tries = 0;
let unlockedByTyping = false;

function norm(s){
  return s.toLowerCase()
          .replace(/[.,?!]/g,'')  // 구두점 무시
          .replace(/\s+/g,' ')     // 다중 공백 정리
          .trim();
}

function render(){
  const it = items[idx];
  $num.textContent = idx+1;
  $dialogue.innerHTML = it.context;
  $ans.value = '';
  $ans.focus();
  tries = 0;
  unlockedByTyping = false;
  $msg.textContent = '';
  $msg.className = 'msg';
  $reveal.style.display = 'none';
  $reveal.textContent = '';
  // 버튼 상태
  $show.disabled = true;   $show.classList.add('disabled');
  $next.disabled = true;   $next.classList.add('disabled');
  updateBar();
}

function updateBar(){
  const pct = Math.round((idx)/total*100);
  $bar.style.width = pct + '%';
}

function enableShowIfNeeded(){
  if(tries >= MAX_TRIES){
    $show.disabled = false;
    $show.classList.remove('disabled');
  }
}

function check(){
  const user = norm($ans.value);
  const right = norm(items[idx].ans);

  if(!user){
    $msg.textContent = '입력 후 확인을 눌러 주세요.';
    $msg.className = 'msg bad';
    return;
  }

  if(user === right){
    $msg.textContent = '정답입니다! 다음으로 진행하세요.';
    $msg.className = 'msg ok';
    unlockedByTyping = true;
    $next.disabled = false;
    $next.classList.remove('disabled');
  }else{
    tries++;
    $msg.innerHTML = `오답입니다. 다시 시도해 보세요. <small>(${tries}/${MAX_TRIES})</small>`;
    $msg.className = 'msg bad';
    enableShowIfNeeded();
  }
}

function showAnswer(){
  if($show.disabled) return;
  const ans = items[idx].ans;
  $reveal.style.display = 'block';
  $reveal.innerHTML = `<b>정답</b>: <code>${ans}</code><br>※ 정답을 그대로 타이핑해야 <b>다음</b>으로 이동할 수 있어요.`;
  $ans.focus();
}

function next(){
  if(!unlockedByTyping){
    $msg.textContent = '정답을 정확히 입력해야 다음으로 진행할 수 있어요.';
    $msg.className = 'msg bad';
    return;
  }
  if(idx < total-1){
    idx++;
    render();
  }else{
    $bar.style.width = '100%';
    $dialogue.innerHTML = '<b>🎉 수고했어요! 모든 문항을 마쳤습니다.</b>';
    $ans.disabled = true;
    $check.disabled = true; $check.classList.add('disabled');
    $show.disabled = true;  $show.classList.add('disabled');
    $next.disabled = true;  $next.classList.add('disabled');
    $msg.textContent = 'Congratulations! You did a great job.';
    $msg.className = 'msg ok';
  }
}

function resetAll(){
  idx = 0; tries = 0; unlockedByTyping = false;
  $ans.disabled = false; $check.disabled = false; $check.classList.remove('disabled');
  render();
}

$check.addEventListener('click', check);
$show.addEventListener('click', showAnswer);
$next.addEventListener('click', next);
$reset.addEventListener('click', resetAll);
$ans.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ e.preventDefault(); check(); }
});

render();
</script>
</body>
</html>
